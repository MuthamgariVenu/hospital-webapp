<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Ashwini Neuro Center</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="./assets/images/logo.png" type="image/png" />

  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.4s ease-out; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col items-center">

  <!-- üåü Header -->
  <header class="w-full bg-white shadow p-4 flex items-center justify-between relative">
    <div class="flex items-center space-x-2">
      <img src="./assets/images/logo.png" class="w-10 h-10 rounded-full shadow-sm" alt="logo" />
      <h1 id="title" class="text-xl md:text-2xl font-bold text-gray-800">‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç</h1>
    </div>

    <div class="flex items-center space-x-4">
      <!-- üåê Language Dropdown -->
      <div>
        <span class="text-gray-600 font-medium mr-1">Ln</span>
        <select id="langSelect" class="border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none">
          <option value="te" selected>‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="en">English</option>
        </select>
      </div>

      <!-- üîô Back Button -->
      <button onclick="goBack()" class="bg-blue-50 hover:bg-blue-100 p-2 rounded-full transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </header>

  <!-- ü©∫ Admin Content -->
  <section class="bg-white shadow-md rounded-2xl p-8 mt-10 w-11/12 md:w-3/4 text-center fade-in">
    <h2 id="todayOPTitle" class="text-xl font-semibold text-gray-800 mb-4">‡∞à ‡∞∞‡±ã‡∞ú‡±Å ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ì‡∞™‡±Ä‡∞≤‡±Å</h2>
    <p id="todayCount" class="text-5xl font-bold text-blue-600 mb-4">0</p>

    <div class="overflow-x-auto mt-6">
      <table class="min-w-full bg-white border border-gray-200 rounded-xl">
        <thead class="bg-blue-50">
          <tr>
            <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600" id="thOp">‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç</th>
            <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600" id="thPatient">‡∞∞‡±ã‡∞ó‡∞ø ‡∞™‡±á‡∞∞‡±Å</th>
            <th class="py-3 px-4 text-left text-sm font-semibold text-gray-600" id="thDoctor">‡∞°‡∞æ‡∞ï‡±ç‡∞ü‡∞∞‡±ç</th>
          </tr>
        </thead>
        <tbody id="opTable" class="text-sm text-gray-700"></tbody>
      </table>
    </div>
  </section>

  <script>
    const API_URL = "https://hospital-server-p4gy.onrender.com";
    const langSelect = document.getElementById("langSelect");
    const todayCountEl = document.getElementById("todayCount");
    const opTable = document.getElementById("opTable");

    const translations = {
      te: {
        title: "‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç",
        todayOP: "‡∞à ‡∞∞‡±ã‡∞ú‡±Å ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ì‡∞™‡±Ä‡∞≤‡±Å",
        thOp: "‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç",
        thPatient: "‡∞∞‡±ã‡∞ó‡∞ø ‡∞™‡±á‡∞∞‡±Å",
        thDoctor: "‡∞°‡∞æ‡∞ï‡±ç‡∞ü‡∞∞‡±ç"
      },
      en: {
        title: "Ashwini Neuro Center",
        todayOP: "Today's OP Count",
        thOp: "OP Number",
        thPatient: "Patient Name",
        thDoctor: "Doctor"
      }
    };

    function goBack() { window.history.back(); }

    function switchLanguage(lang) {
      localStorage.setItem("userLang", lang);
      const t = translations[lang];
      document.getElementById("title").textContent = t.title;
      document.getElementById("todayOPTitle").textContent = t.todayOP;
      document.getElementById("thOp").textContent = t.thOp;
      document.getElementById("thPatient").textContent = t.thPatient;
      document.getElementById("thDoctor").textContent = t.thDoctor;
    }

    const savedLang = localStorage.getItem("userLang") || "te";
    langSelect.value = savedLang;
    switchLanguage(savedLang);
    langSelect.addEventListener("change", (e) => switchLanguage(e.target.value));

    // üßÆ Fetch today's OPs
    async function fetchTodayOPs() {
      try {
        const res = await fetch(`${API_URL}/api/getOPs`);
        const ops = await res.json();
        const today = new Date().toISOString().split("T")[0];

        // Filter today‚Äôs entries
        const todaysOPs = ops.filter(op => op.createdAt && op.createdAt.startsWith(today));
        todayCountEl.textContent = todaysOPs.length;

        opTable.innerHTML = "";
        if (todaysOPs.length === 0) {
          opTable.innerHTML = `<tr><td colspan="3" class="text-center py-4 text-gray-500">No OP entries today</td></tr>`;
          return;
        }

        todaysOPs.forEach(op => {
          const row = `
            <tr class="border-t">
              <td class="py-2 px-4 font-semibold text-blue-600">${op.opNumber}</td>
              <td class="py-2 px-4">${op.patientName}</td>
              <td class="py-2 px-4">${op.doctorName}</td>
            </tr>
          `;
          opTable.innerHTML += row;
        });
      } catch (err) {
        console.error("Error fetching OP data:", err);
      }
    }

    fetchTodayOPs();
  </script>
</body>
</html>
