<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track OP | Ashwini Neuro Center</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2966/2966481.png">

  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.4s ease-out; }
  </style>
</head>

<body class="bg-gray-50 flex flex-col items-center min-h-screen justify-center">

  <!-- üè• Header -->
  <div class="text-center mb-8 flex justify-center items-center space-x-2">
    <img src="https://cdn-icons-png.flaticon.com/512/2966/2966481.png" class="w-8 h-8" alt="logo">
    <h1 id="title" class="text-2xl md:text-3xl font-bold text-gray-800">‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç</h1>
  </div>

  <!-- üîç OP Track Form -->
  <div id="trackForm" class="bg-white shadow-lg rounded-2xl p-6 w-11/12 md:w-1/3 fade-in text-center">
    <h2 id="formTitle" class="text-xl font-semibold text-gray-800 mb-4">‡∞Æ‡±Ä ‡∞ì‡∞™‡∞ø ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</h2>
    <input id="opInput" type="text" placeholder="‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø"
      class="w-full border-2 border-blue-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:border-blue-500 text-center">
    <button id="trackBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-semibold transition">
      ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
    </button>
  </div>

  <!-- ‚úÖ Result Card -->
  <div id="resultCard" class="hidden bg-white shadow-lg rounded-2xl p-6 w-11/12 md:w-1/3 text-center fade-in">
    <div class="flex justify-center mb-3">
      <div class="bg-blue-100 text-blue-600 p-2 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
      </div>
    </div>
    <h2 id="resultTitle" class="text-xl font-bold text-gray-800 mb-2">‡∞Æ‡±Ä ‡∞ì‡∞™‡∞ø ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø</h2>

    <p id="labelOp" class="text-gray-600 mb-1">‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç</p>
    <p id="resultOpNumber" class="text-3xl font-bold text-blue-700 mb-4">‚Äî</p>

    <p id="labelQueue" class="text-gray-600 mb-1">‡∞Æ‡±Ä ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞â‡∞®‡±ç‡∞® ‡∞∞‡±ã‡∞ó‡±Å‡∞≤‡±Å</p>
    <p id="resultQueue" class="text-3xl font-bold text-gray-800 mb-4">‚Äî</p>

    <p id="labelTime" class="text-gray-600 mb-1">‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç ‡∞∏‡∞Æ‡∞Ø‡∞Ç</p>
    <p id="resultTime" class="text-2xl font-semibold text-gray-800 mb-4">‚Äî</p>

    <button onclick="goBack()" id="backBtn"
      class="w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 rounded-lg font-medium">
      ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞Ç‡∞°‡∞ø
    </button>
  </div>

  <script>
    const API_URL = "https://hospital-server-p4gy.onrender.com";

    // Elements
    const formCard = document.getElementById("trackForm");
    const resultCard = document.getElementById("resultCard");
    const input = document.getElementById("opInput");
    const btn = document.getElementById("trackBtn");

    const resultOpNumber = document.getElementById("resultOpNumber");
    const resultQueue = document.getElementById("resultQueue");
    const resultTime = document.getElementById("resultTime");

    // Text Elements
    const translatable = {
      title: document.getElementById("title"),
      formTitle: document.getElementById("formTitle"),
      input: document.getElementById("opInput"),
      trackBtn: document.getElementById("trackBtn"),
      resultTitle: document.getElementById("resultTitle"),
      labelOp: document.getElementById("labelOp"),
      labelQueue: document.getElementById("labelQueue"),
      labelTime: document.getElementById("labelTime"),
      backBtn: document.getElementById("backBtn"),
    };

    // Translations
    const translations = {
      te: {
        title: "‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç",
        formTitle: "‡∞Æ‡±Ä ‡∞ì‡∞™‡∞ø ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        inputPlaceholder: "‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø",
        trackBtn: "‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        resultTitle: "‡∞Æ‡±Ä ‡∞ì‡∞™‡∞ø ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø",
        labelOp: "‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç",
        labelQueue: "‡∞Æ‡±Ä ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞â‡∞®‡±ç‡∞® ‡∞∞‡±ã‡∞ó‡±Å‡∞≤‡±Å",
        labelTime: "‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±á‡∞∑‡∞®‡±ç ‡∞∏‡∞Æ‡∞Ø‡∞Ç",
        backBtn: "‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞Ç‡∞°‡∞ø",
        invalidOp: "‡∞§‡∞™‡±ç‡∞™‡±Å ‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞ö‡±ç‡∞ö‡∞æ‡∞∞‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        error: "‡∞∏‡∞∞‡±ç‡∞µ‡∞∞‡±ç ‡∞≤‡±ã‡∞™‡∞Ç. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞ï‡±ä‡∞Ç‡∞§‡∞∏‡±á‡∞™‡∞ü‡∞ø ‡∞§‡∞∞‡±Å‡∞µ‡∞æ‡∞§ ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        empty: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞ì‡∞™‡∞ø ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø."
      },
      en: {
        title: "Ashwini Neuro Center",
        formTitle: "Track Your OP",
        inputPlaceholder: "Enter OP Number",
        trackBtn: "Track OP Status",
        resultTitle: "Your OP booking is confirmed",
        labelOp: "Your OP Number",
        labelQueue: "Patients ahead of you",
        labelTime: "Expected consultation time",
        backBtn: "Go Back",
        invalidOp: "Invalid OP number. Please try again.",
        error: "Server error. Please try again later.",
        empty: "Please enter your OP number."
      }
    };

    // Apply selected language
    function applyLanguage(lang) {
      const t = translations[lang];
      translatable.title.textContent = t.title;
      translatable.formTitle.textContent = t.formTitle;
      translatable.input.placeholder = t.inputPlaceholder;
      translatable.trackBtn.textContent = t.trackBtn;
      translatable.resultTitle.textContent = t.resultTitle;
      translatable.labelOp.textContent = t.labelOp;
      translatable.labelQueue.textContent = t.labelQueue;
      translatable.labelTime.textContent = t.labelTime;
      translatable.backBtn.textContent = t.backBtn;
    }

    // Load saved language
    const lang = localStorage.getItem("userLang") || "te";
    applyLanguage(lang);

    function goBack() {
      resultCard.classList.add("hidden");
      formCard.classList.remove("hidden");
      input.value = "";
    }

    // Fetch OP details
    async function fetchOpStatus(opNumber) {
      try {
        const t = translations[lang];
        const res = await fetch(`${API_URL}/api/getOPs`);
        const data = await res.json();
        const currentIndex = data.findIndex(op => op.opNumber === opNumber);
        if (currentIndex === -1) {
          alert(t.invalidOp);
          return;
        }

        const patientsAhead = data.length - currentIndex - 1;
        const expectedTime = new Date();
        expectedTime.setMinutes(expectedTime.getMinutes() + (patientsAhead * 10));

        resultOpNumber.textContent = opNumber;
        resultQueue.textContent = patientsAhead;
        resultTime.textContent = expectedTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        formCard.classList.add("hidden");
        resultCard.classList.remove("hidden");
      } catch (err) {
        alert(translations[lang].error);
      }
    }

    // Manual entry
    btn.addEventListener("click", () => {
      const op = input.value.trim();
      const t = translations[lang];
      if (!op) {
        alert(t.empty);
        return;
      }
      fetchOpStatus(op);
    });

    // Auto-open for WhatsApp/Twilio links
    const urlParams = new URLSearchParams(window.location.search);
    const autoOP = urlParams.get("op");
    if (autoOP) fetchOpStatus(autoOP);
  </script>
</body>
</html>
