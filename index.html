<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç | Ashwini Neuro Center</title>

  <!-- Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="./assets/images/logo.png" type="image/png" />

  <style>
    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .scroll-text {
      display:inline-block; white-space:nowrap;
      animation: ticker 25s linear infinite;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col items-center">

  <!-- üåü Header -->
  <header class="w-full bg-white shadow p-4 flex flex-col md:flex-row md:items-center md:justify-between relative">
    <div class="flex items-center justify-between md:justify-start space-x-2 w-full md:w-auto">
      <div class="flex items-center space-x-2">
        <img src="./assets/images/logo.png" class="w-10 h-10 mr-2 rounded-full shadow-sm" alt="logo" />
        <h1 id="title" class="text-xl md:text-2xl font-bold text-gray-800">‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç</h1>
      </div>

      <!-- üåê Language Dropdown -->
      <div class="md:absolute md:right-14 flex items-center">
        <span class="text-gray-600 font-medium mr-1">Ln</span>
        <select id="langSelect" class="border border-gray-300 rounded-md px-2 py-1 text-sm focus:outline-none">
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <!-- üß≠ Desktop Buttons -->
    <nav class="hidden md:flex justify-center items-center space-x-4 absolute left-1/2 transform -translate-x-1/2">
      <a href="op-booking.html" id="opBookingBtn" class="flex items-center space-x-1 bg-blue-50 px-4 py-2 rounded-lg hover:bg-blue-100 transition">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828673.png" class="w-5 h-5" />
        <span>‡∞ì‡∞™‡∞ø ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç</span>
      </a>
      <a href="service.html" id="serviceBtn" class="flex items-center space-x-1 bg-blue-50 px-4 py-2 rounded-lg hover:bg-blue-100 transition">
        <img src="https://cdn-icons-png.flaticon.com/512/599/599502.png" class="w-5 h-5" />
        <span>‡∞∏‡±á‡∞µ</span>
      </a>
      <a href="admin.html" id="adminBtn" class="flex items-center space-x-1 bg-blue-50 px-4 py-2 rounded-lg hover:bg-blue-100 transition">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-5 h-5" />
        <span>‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç</span>
      </a>
    </nav>
  </header>

  <!-- üß≠ Mobile Buttons -->
  <nav class="flex md:hidden justify-center gap-3 bg-blue-50 py-3 w-full shadow-sm">
    <a href="op-booking.html" id="opBookingBtnMobile" class="flex items-center space-x-1 bg-white px-4 py-2 rounded-lg hover:bg-blue-100 transition">
      <img src="https://cdn-icons-png.flaticon.com/512/1828/1828673.png" class="w-5 h-5" />
      <span>‡∞ì‡∞™‡∞ø ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç</span>
    </a>
    <a href="service.html" id="serviceBtnMobile" class="flex items-center space-x-1 bg-white px-4 py-2 rounded-lg hover:bg-blue-100 transition">
      <img src="https://cdn-icons-png.flaticon.com/512/599/599502.png" class="w-5 h-5" />
      <span>‡∞∏‡±á‡∞µ</span>
    </a>
    <a href="admin.html" id="adminBtnMobile" class="flex items-center space-x-1 bg-white px-4 py-2 rounded-lg hover:bg-blue-100 transition">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-5 h-5" />
      <span>‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç</span>
    </a>
  </nav>

  <!-- üö® Emergency Alert -->
  <section onclick="handleEmergencyClick()" class="cursor-pointer w-11/12 md:w-3/4 mt-4 bg-white border border-gray-200 shadow rounded-xl overflow-hidden hover:bg-gray-50 transition">
    <div id="emergencyAlert" class="scroll-text px-4 py-2 text-red-600 font-semibold text-sm md:text-base">
      üö® ‡∞Ö‡∞§‡±ç‡∞Ø‡∞µ‡∞∏‡∞∞ ‡∞ï‡±á‡∞∏‡±Å: ‡∞ì‡∞™‡∞ø ‡∞≤‡±á‡∞ï‡±Å‡∞Ç‡∞°‡∞æ ‡∞®‡±á‡∞∞‡±Å‡∞ó‡∞æ ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç ‡∞µ‡∞¶‡±ç‡∞¶ ‚Äì ‡∞°‡∞æ. ‡∞∏‡±Å‡∞∞‡±á‡∞∑‡±ç ‡∞ï‡±Å‡∞Æ‡∞æ‡∞∞‡±ç, ‡∞ó‡∞¶‡∞ø ‡∞®‡∞Ç. 3
    </div>
  </section>

  <!-- ü©∫ Now Consulting Section -->
  <section class="bg-white shadow-md rounded-2xl p-8 mt-10 w-11/12 md:w-2/3 text-center">
    <h2 id="consultingTitle" class="text-xl font-semibold text-gray-800 mb-4">‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞Ç ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç</h2>

    <div id="currentBox" class="p-4 rounded-xl mb-4 bg-green-50 border border-green-300">
      <p class="text-gray-700 font-semibold" id="nowDoctor">‡∞µ‡±à‡∞¶‡±ç‡∞Ø‡±Å‡∞°‡±Å: ‚Äî</p>
      <p class="text-gray-700" id="nowPatient">‡∞∞‡±ã‡∞ó‡∞ø: ‚Äî</p>
    </div>

    <div id="nextBox" class="p-4 rounded-xl bg-yellow-50 border border-yellow-300">
      <p class="text-gray-700 font-semibold" id="nextLabel">‡∞§‡∞¶‡±Å‡∞™‡∞∞‡∞ø ‡∞ï‡±ç‡∞Ø‡±Ç‡∞≤‡±ã:</p>
      <p class="text-gray-900 font-medium" id="nextPatient">‚Äî</p>
    </div>

    <p id="totalPatients" class="text-gray-600 mt-3 text-sm">‚Äî</p>
  </section>

  <!-- üß≠ Track OP Button -->
  <a href="track-op.html"
     id="trackButton"
     class="mt-6 inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-md transition text-center">
     ‡∞®‡∞æ ‡∞ì‡∞™‡∞ø ‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø‡∞®‡∞ø ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø
  </a>

  <!-- üåê JS -->
  <script>
    const API_URL = "http://localhost:5000";

    const translations = {
      te: {
        title: "‡∞Ö‡∞∂‡±ç‡∞µ‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡±ã ‡∞∏‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç",
        consulting: "‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§‡∞Ç ‡∞ï‡∞®‡±ç‡∞∏‡∞≤‡±ç‡∞ü‡∞ø‡∞Ç‡∞ó‡±ç",
        doctorLabel: "‡∞µ‡±à‡∞¶‡±ç‡∞Ø‡±Å‡∞°‡±Å:",
        patientLabel: "‡∞∞‡±ã‡∞ó‡∞ø:",
        nextLabel: "‡∞§‡∞¶‡±Å‡∞™‡∞∞‡∞ø ‡∞ï‡±ç‡∞Ø‡±Ç‡∞≤‡±ã:",
        total: "‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞∞‡±ã‡∞ó‡±Å‡∞≤‡±Å:",
        track: "‡∞®‡∞æ ‡∞ì‡∞™‡∞ø ‡∞∏‡±ç‡∞•‡∞ø‡∞§‡∞ø‡∞®‡∞ø ‡∞ü‡±ç‡∞∞‡∞æ‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø"
      },
      en: {
        title: "Ashwini Neuro Center",
        consulting: "Now Consulting",
        doctorLabel: "Doctor:",
        patientLabel: "Patient:",
        nextLabel: "Next in Queue:",
        total: "Total Patients:",
        track: "Track My OP Status"
      }
    };

    // ‚úÖ Helper to translate English text ‚Üí Telugu
    async function translateToTelugu(text) {
      if (!text || text === "‚Äî") return text;
      try {
        const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|te`);
        const data = await res.json();
        return data.responseData.translatedText || text;
      } catch (e) {
        console.error("Translation error:", e);
        return text;
      }
    }

    function handleEmergencyClick() {
      window.location.href = "emergency.html";
    }

    // ‚úÖ Fetch + Auto Translate if Telugu selected
    async function fetchConsultingData() {
      try {
        const [consultingRes, nextRes, allRes] = await Promise.all([
          fetch(`${API_URL}/api/current-consulting`),
          fetch(`${API_URL}/api/next-in-queue`),
          fetch(`${API_URL}/api/getOPs`)
        ]);

        const consulting = await consultingRes.json();
        const next = await nextRes.json();
        const all = await allRes.json();

        const lang = localStorage.getItem("userLang") || "te";
        const t = translations[lang];

        let doctorName = consulting?.doctorName || "‚Äî";
        let patientName = consulting?.patientName || "‚Äî";
        let nextPatientName = next?.patientName || "‚Äî";

        if (lang === "te") {
          doctorName = await translateToTelugu(doctorName);
          patientName = await translateToTelugu(patientName);
          nextPatientName = await translateToTelugu(nextPatientName);
        }

        document.getElementById("title").textContent = t.title;
        document.getElementById("consultingTitle").textContent = t.consulting;
        document.getElementById("nextLabel").textContent = t.nextLabel;
        document.getElementById("trackButton").textContent = t.track;

        document.getElementById("nowDoctor").textContent = `${t.doctorLabel} ${doctorName}`;
        document.getElementById("nowPatient").textContent = `${t.patientLabel} ${patientName}`;
        document.getElementById("nextPatient").textContent = nextPatientName;
        document.getElementById("totalPatients").textContent = `${t.total} ${all.length}`;
      } catch (err) {
        console.error("Queue Fetch Error:", err);
      }
    }

    // üîÅ Refresh every 5 seconds
    setInterval(fetchConsultingData, 5000);
    fetchConsultingData();

    // üåê Language Switch
    const langSelect = document.getElementById("langSelect");
    const savedLang = localStorage.getItem("userLang") || "te";
    langSelect.value = savedLang;

    langSelect.addEventListener("change", e => {
      const lang = e.target.value;
      localStorage.setItem("userLang", lang);
      fetchConsultingData();
    });
  </script>
</body>
</html>
