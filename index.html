<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ashwini Neuro Center</title>

  <!-- ðŸ§  Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- âœ… Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ðŸ©µ Favicon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2966/2966481.png" />
</head>

<body class="bg-gray-50 min-h-screen flex flex-col items-center">
  <!-- ðŸŒŸ Header -->
  <header class="w-full bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center">
      <img src="https://cdn-icons-png.flaticon.com/512/2966/2966481.png" class="w-8 h-8 mr-2" alt="logo" />
      Ashwini Neuro Center
    </h1>
    <nav class="space-x-4 text-gray-700">
      <a href="index.html" class="hover:text-blue-600 font-medium">Home</a>
      <a href="admin.html" class="hover:text-blue-600 font-medium">Admin</a>
      <a href="#" class="hover:text-blue-600 font-medium">Contact</a>
    </nav>
  </header>

  <!-- ðŸ§¾ Stats Section -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 w-11/12 md:w-4/5">
    <div class="bg-white shadow-md rounded-2xl p-6 text-center">
      <h2 class="text-gray-500 text-lg">Total OP Count</h2>
      <p id="totalOP" class="text-4xl font-bold text-blue-600 mt-2">0</p>
    </div>
    <div class="bg-white shadow-md rounded-2xl p-6 text-center">
      <h2 class="text-gray-500 text-lg">1st Consultation Done</h2>
      <p id="firstConsult" class="text-4xl font-bold text-green-600 mt-2">0</p>
    </div>
    <div class="bg-white shadow-md rounded-2xl p-6 text-center">
      <h2 class="text-gray-500 text-lg">2nd Consultation Done</h2>
      <p id="secondConsult" class="text-4xl font-bold text-purple-600 mt-2">0</p>
    </div>
  </section>

  <!-- ðŸ©µ OP Booking Button Section -->
  <section class="mt-10 w-11/12 md:w-2/3 flex justify-center">
    <a href="op-booking.html"
      class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-md text-lg transition-all duration-300">
      Book OP Appointment
    </a>
  </section>

  <!-- ðŸ©º Now Consulting Section -->
  <section class="bg-white shadow-md rounded-2xl p-8 mt-10 w-11/12 md:w-2/3 text-center">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Now Consulting</h2>
    <p class="text-gray-700" id="nowDoctor">Doctor: â€”</p>
    <p class="text-gray-700" id="nowPatient">Patient: â€”</p>

    <hr class="my-4" />

    <p class="text-gray-700">Next in Queue:</p>
    <p class="text-gray-900 font-medium" id="nextPatient">â€”</p>

    <button
      id="trackButton"
      class="mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-md">
      Track My OP Status
    </button>
  </section>

  <!-- ðŸ”— JS -->
  <script>
    const API_URL = "https://hospital-server-p4gy.onrender.com"; // Your live backend API

    async function fetchStats() {
      try {
        const res = await fetch(`${API_URL}/api/stats`);
        const data = await res.json();
        document.getElementById("totalOP").textContent = data.total;
        document.getElementById("firstConsult").textContent = data.first;
        document.getElementById("secondConsult").textContent = data.second;
      } catch (err) {
        console.error("Error fetching stats:", err);
      }
    }

    async function fetchNowConsulting() {
      try {
        const res = await fetch(`${API_URL}/api/getOPs`);
        const ops = await res.json();

        if (ops.length > 0) {
          const current = ops[ops.length - 1];
          const next = ops.length > 1 ? ops[ops.length - 2] : null;

          document.getElementById("nowDoctor").textContent = `Doctor: ${current.doctorName}`;
          document.getElementById("nowPatient").textContent = `Patient: ${current.patientName} (OP No: ${current.opNumber})`;
          document.getElementById("nextPatient").textContent = next
            ? `${next.patientName} (OP No: ${next.opNumber})`
            : "â€”";
        }
      } catch (err) {
        console.error("Error fetching OP data:", err);
      }
    }

    fetchStats();
    fetchNowConsulting();
  </script>
</body>
</html>
